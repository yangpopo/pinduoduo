// 顶部导航

import React, { Fragment, useState, useEffect } from 'react';
import "./topNavigation.scss";
import { NavBar } from 'zarm';
import { Link } from "react-router-dom";
import { connect } from "react-redux"; // 链接全局状态
import { modifyReturnButtonStatus } from "../../store/";
import ShareIconBlock from "common/shareIconBlock/ShareIconBlock"; // 分享图标按钮

import Swiper from "swiper";
import "../../../../../node_modules/swiper/dist/css/swiper.min.css";

import headPortrait from "assets/img/picture/head-portrait.jpg";

const TopNavigation = (props) => {
  const [transparencyVal, setTransparencyVal] = useState(0);

  // 滚动显示/隐藏
  function scrollVal(e) {
    if (e.target.scrollTop < 200) {
      let speedVal = e.target.scrollTop / 200;
      setTransparencyVal(speedVal);
    } else {
      setTransparencyVal(1);
    }
  }

  // 返回按钮类型
  function returnBut() {
    if (props.backType === "back") {
      // 返回上一页
      props.history.goBack();
    } else if (props.backType === "evaluation") {
      props.modifyReturnButtonStatus("back");
    }
  }

  useEffect(() => {
    let navInfoSwiper = new Swiper('.nav-info-swiper-container', {
      direction: 'vertical',
      spaceBetween: 0,
      loop : true,
      autoplay : {
        delay:3000
      },
    });
    document.querySelector(".product-details").addEventListener("scroll", scrollVal);
    return () => {
      document.querySelector(".product-details").removeEventListener("scroll", scrollVal);
      navInfoSwiper.destroy(true);
    }
  }, [transparencyVal]);
  
  return (
    <div className="top-navigation">
      <div className="transparent-navigation" style={{opacity: 1 - transparencyVal}}>
        <i className="return-but" onClick={() => { props.history.goBack() }}><svg className="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="100838"><path d="M292.543659 458.274133c13.5168 0 27.0336 5.632 37.819733 16.384l438.749867 453.7344c21.060267 22.016 21.060267 57.002667 0.546133 79.018667a52.053333 52.053333 0 0 1-75.639467 0.580267L255.235925 554.222933c-21.0944-21.435733-21.0944-57.002667-0.546133-79.018666 9.728-11.844267 23.790933-16.930133 37.819733-16.930134zM726.412459 0c13.5168 0 27.0336 5.632 37.853866 16.384 21.060267 21.981867 21.060267 57.002667 0.512 78.984533L330.363392 553.642667a52.053333 52.053333 0 0 1-75.639467 0.580266c-21.060267-21.435733-21.060267-57.002667-0.546133-79.018666L688.592725 16.930133C698.866859 5.666133 712.963925 0 726.412459 0z" p-id="100839"></path></svg></i>
        <div className="function-box">
          <Link to="/sdf" className="icon-but"><svg className="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="63137" data-spm-anchor-id="a313x.7781069.1998910419.i3"><path d="M510.751269 250.769661c-142.191516 0-257.463676 116.684659-257.463676 260.585503S368.549518 771.940666 510.751269 771.940666s257.463676-116.684659 257.463676-260.585502C768.20471 368.037743 652.93255 250.769661 510.751269 250.769661z m0 401.579465c-76.878813 0-138.721682-63.183719-138.721682-140.400303 0-77.789773 62.436528-140.400304 138.721682-140.400304 76.868578 0 138.721682 63.183719 138.721683 140.400304s-62.436528 140.400304-138.721683 140.400303z" fill="#FE3D23" p-id="63138"></path><path d="M510.751269 430.054616a81.883971 81.883971 0 1 0 81.883971 81.883971 82.088681 82.088681 0 0 0-81.883971-81.883971z" fill="#FE7523" p-id="63139"></path><path d="M518.775899 0.450362C240.257807 0.450362 13.991924 229.459358 13.991924 511.355164c0 77.892127 16.653153 152.283715 49.959457 222.028387 0 2.333693 1.156611 13.950982-10.911039 58.710807-8.034865 29.058574-18.423893 61.024029-25.834393 84.279078C1.361321 956.578785-8.403343 986.804206 8.24981 1008.892407c7.461677 9.877254 19.529327 15.107593 33.306305 15.107593 19.529327 0 46.520331-9.877254 96.479789-27.891728 43.644157-16.274439 103.378513-38.36264 130.93247-38.36264h4.02255a497.987605 497.987605 0 0 0 245.784975 64.483627C797.345168 1022.259966 1023.549638 793.25097 1023.549638 511.355164S797.345168 0.450362 518.775899 0.450362z m10.327615 105.057135c7.052257 0 14.401343-0.081884 21.84255 0 16.131142 0.194474 28.290912 15.056415 27.441366 31.023789-0.276358 15.629603-13.306145 27.63584-29.191636 27.63584h-19.519092c-15.865019 0-28.65939-12.456599-29.744352-28.97669v-1.023549c-0.030706-16.376794 12.79437-28.65939 29.171164-28.65939zM510.751269 832.780457c-175.149814 0-317.576746-144.146496-317.576746-321.394587s142.426932-321.394586 317.576746-321.394586 317.576746 144.13626 317.576747 321.394586c-0.583423 177.248091-143.010355 321.394586-317.576747 321.394587z m370.95486-312.27476a28.97669 28.97669 0 0 1-29.201871-29.375874c0-146.603015-97.626164-276.153692-237.463516-315.161169a28.311383 28.311383 0 0 1-17.973532-13.0912 29.764823 29.764823 0 0 1-3.009236-23.357403 30.338011 30.338011 0 0 1 14.575347-18.423893 28.116909 28.116909 0 0 1 21.668546-2.282516C795.533485 164.791492 910.897765 317.873576 910.897765 491.129823a28.97669 28.97669 0 0 1-29.191636 29.375874z" fill="#FE7523" p-id="63140"></path></svg></Link>
          <ShareIconBlock className="icon-but" />
        </div>
      </div>

      <NavBar
        left={
          <i className="arrow-left-icon" onClick={() => {returnBut()}}>
            <svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1427"><path d="M670.676929 777.592984 403.62778 513.362021l265.320785-268.146133c11.776208-11.775184 11.734252-30.908964-0.091074-42.73429l-0.001023 0c-11.825326-11.82635-30.958082-11.867282-42.72815 2.930749L343.100242 488.440421c-3.817955 4.273327-8.205892 9.321296-8.933463 12.045337-4.470825 11.112082-2.232854 24.765033 6.710842 35.987632l286.98213 286.98213c11.875468 8.847505 31.096229 8.893554 42.922578-2.932796C682.606633 808.696376 682.560584 789.476639 670.676929 777.592984z" p-id="1428"></path></svg>
          </i>
        }
        className="default-navigation"
        style={{opacity: transparencyVal}}
        title={
        <div className="swiper-container nav-info-swiper-container">
          <div className="swiper-wrapper">
            <div className="swiper-slide nav-roll"><img src={headPortrait} alt="" />11分钟前并单成功!</div>
            <div className="swiper-slide nav-roll"><img src={headPortrait} alt="" />5分钟前并单成功!</div>
            <div className="swiper-slide nav-roll"><img src={headPortrait} alt="" />2小时前并单成功!</div>
            <div className="swiper-slide nav-roll"><img src={headPortrait} alt="" />6小时前并单成功!</div>
          </div>
        </div>
        }
        right={
          <Fragment>
            <Link to="/sdf" className="icon-but"><svg className="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="63137" data-spm-anchor-id="a313x.7781069.1998910419.i3"><path d="M510.751269 250.769661c-142.191516 0-257.463676 116.684659-257.463676 260.585503S368.549518 771.940666 510.751269 771.940666s257.463676-116.684659 257.463676-260.585502C768.20471 368.037743 652.93255 250.769661 510.751269 250.769661z m0 401.579465c-76.878813 0-138.721682-63.183719-138.721682-140.400303 0-77.789773 62.436528-140.400304 138.721682-140.400304 76.868578 0 138.721682 63.183719 138.721683 140.400304s-62.436528 140.400304-138.721683 140.400303z" fill="#FE3D23" p-id="63138"></path><path d="M510.751269 430.054616a81.883971 81.883971 0 1 0 81.883971 81.883971 82.088681 82.088681 0 0 0-81.883971-81.883971z" fill="#FE7523" p-id="63139"></path><path d="M518.775899 0.450362C240.257807 0.450362 13.991924 229.459358 13.991924 511.355164c0 77.892127 16.653153 152.283715 49.959457 222.028387 0 2.333693 1.156611 13.950982-10.911039 58.710807-8.034865 29.058574-18.423893 61.024029-25.834393 84.279078C1.361321 956.578785-8.403343 986.804206 8.24981 1008.892407c7.461677 9.877254 19.529327 15.107593 33.306305 15.107593 19.529327 0 46.520331-9.877254 96.479789-27.891728 43.644157-16.274439 103.378513-38.36264 130.93247-38.36264h4.02255a497.987605 497.987605 0 0 0 245.784975 64.483627C797.345168 1022.259966 1023.549638 793.25097 1023.549638 511.355164S797.345168 0.450362 518.775899 0.450362z m10.327615 105.057135c7.052257 0 14.401343-0.081884 21.84255 0 16.131142 0.194474 28.290912 15.056415 27.441366 31.023789-0.276358 15.629603-13.306145 27.63584-29.191636 27.63584h-19.519092c-15.865019 0-28.65939-12.456599-29.744352-28.97669v-1.023549c-0.030706-16.376794 12.79437-28.65939 29.171164-28.65939zM510.751269 832.780457c-175.149814 0-317.576746-144.146496-317.576746-321.394587s142.426932-321.394586 317.576746-321.394586 317.576746 144.13626 317.576747 321.394586c-0.583423 177.248091-143.010355 321.394586-317.576747 321.394587z m370.95486-312.27476a28.97669 28.97669 0 0 1-29.201871-29.375874c0-146.603015-97.626164-276.153692-237.463516-315.161169a28.311383 28.311383 0 0 1-17.973532-13.0912 29.764823 29.764823 0 0 1-3.009236-23.357403 30.338011 30.338011 0 0 1 14.575347-18.423893 28.116909 28.116909 0 0 1 21.668546-2.282516C795.533485 164.791492 910.897765 317.873576 910.897765 491.129823a28.97669 28.97669 0 0 1-29.191636 29.375874z" fill="#FE7523" p-id="63140"></path></svg></Link>
            <ShareIconBlock className="icon-but" />
          </Fragment>
        }
      />
    </div>
  )
}

// 链接redux数据
const mapStateToProps = (state) => {
  return {
    backType: state.get("productDetails").get("backType"),
  }
}

// 链接处理方法
const mapDispatchToProps = (dispatch, ownProps) => {
  return {
    // 修改全局返回按钮状态
    modifyReturnButtonStatus(val) {
      dispatch(modifyReturnButtonStatus(val));
    }
  }
}

export default connect(mapStateToProps, mapDispatchToProps)(TopNavigation)